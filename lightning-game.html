<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            margin: 100px;
        }

        .target {
            width: 50px;
            height: 50px;
            background-color: teal;
            transition: 0.2s linear;
            position: fixed;
            bottom: 0;
        }

        img {
            width: 50px;
            height: 50px;
            position: fixed;
            transition: all 200ms linear;
            z-index: -1;
        }
    </style>
</head>

<body>

    <div class="target"></div>

    <script>
        // 화살표 키를 눌렀을 때, 왼쪽 화살표를 누르면 상자를 왼쪽으로, 오른쪽 화살표를 누르면 상자를 왼쪽으로 이동합니다. 
        let addLightningInterval = 500;
        let changeLightningInterval = 500;
        let moveLightningInterval = 200;
        let targetOffsetX = 0;
        let boxOffsetXMoveInterval = 30;
        const target = document.querySelector('.target');

        // 시간이 10s 초마다 줄어 듭니다.
        setInterval(decreaseInterval, changeLightningInterval);

        // 1초 마다 번개를 추가합니다.
        setInterval(addLightning, addLightningInterval);

        // 번개를 아래로 내려가게 합니다.
        setInterval(moveLightning, moveLightningInterval);

        document.addEventListener('keydown', move);

        function decreaseInterval() {
            addLightningInterval -= 100;
        }

        function addLightning() {
            const img = document.createElement('img');
            img.src = "./lightning.jpg";

            img.classList.add('a');

            // 가로로 랜덤한 위치에 번개를 추가합니다.
            // img.style.left = `${Math.random() * window.innerWidth}px`;
            img.style.transform = `translateX(${Math.random() * window.innerWidth}px)`;
            img.style.top = '0px';
            document.body.appendChild(img);
        }

        function moveLightning() {
            const lightnings = document.querySelectorAll('img');
            lightnings.forEach((lightning) => {
                const currentTop = Number(lightning.style.top.replace('px', ''));

                // 번개가 화면 밖으로 나가면 번개를 제거합니다.
                if (currentTop + 50 > window.innerHeight) {
                    lightning.remove();
                    return;
                }


                // 번개를 아래로 이동합니다.
                lightning.style.top = `${currentTop + 50}px`;

                // 번개를 이동 시키면서 번개와 상자가 겹치면 게임을 종료합니다.
                if (currentTop + 50 > window.innerHeight - 50) {
                    const lightningOffsetX = Number(lightning.style.transform.replace('translateX(', '').replace('px)', ''));
                    const minLightningOffsetX = lightningOffsetX;
                    const maxLightningOffsetX = lightningOffsetX + 50;

                    const minTargetOffsetX = targetOffsetX;
                    const maxTargetOffsetX = targetOffsetX + 50;

                    if ((minLightningOffsetX < maxTargetOffsetX && minLightningOffsetX > minTargetOffsetX) || (maxLightningOffsetX < maxTargetOffsetX && maxLightningOffsetX > minTargetOffsetX)) {
                        alert('Game Over');
                        location.reload();
                    }
                }
            })
        }

        function move(event) {
            const keyName = event.key;
            const targetPos = target.getBoundingClientRect();

            console.log(keyName);
            if (keyName === 'ArrowRight') {
                if (!(targetPos.right + 10 > window.innerWidth)) {
                    targetOffsetX += boxOffsetXMoveInterval;
                    target.style.transform = `translateX(${targetOffsetX}px)`;
                }
            }

            if (keyName === 'ArrowLeft') {
                if (!(targetPos.left < 0)) {
                    targetOffsetX -= boxOffsetXMoveInterval;
                    target.style.transform = `translateX(${targetOffsetX}px)`;
                }
            }
        }
    </script>
</body>

</html>
